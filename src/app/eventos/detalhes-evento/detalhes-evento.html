<div
    class="md:hidden flex items-center p-4 justify-between bg-surface-light border-t border-gray-200 shadow-[0_-2px_10px_rgba(0,0,0,0.1)]">
    <div class="flex shrink-0 items-center">
        <button class="material-icons" (click)="goBack()">arrow_back</button>
    </div>
    <h2 class="text-md text-text-light leading-tight tracking-[-0.015em] flex-1 text-center">
        Detalhes do Evento
    </h2>
</div>

@if (carregando) {
<app-loading></app-loading>

} @else if (evento?.id) {

<div class="relative h-96">
    <!-- Background desfocado -->
    <div class="absolute inset-0 w-full h-full">
        <img alt="Igreja Videira Background" class="w-full h-full object-cover blur-lg" [src]="evento?.imagem"
            loading="lazy" (load)="loaded = true" [class.opacity-100]="loaded" />
    </div>
    <!-- Imagem principal -->

    <img class="absolute inset-0 w-full h-full object-cover max-w-2xl mx-auto transition-opacity duration-500 opacity-0"
        [src]="evento?.imagem" loading="lazy" (load)="loaded = true" [class.opacity-100]="loaded" />
</div>

<div class="bg-white/90 p-4 rounded-t-xl md:rounded-none shadow-lg mt-[-20px] pb-[20px] relative">
    <div class="max-w-xl mx-auto">
        <h1 class="text-text-light text-[26px] font-bold leading-tight tracking-[-0.015em] text-center pb-3 pt-2">
            {{evento?.titulo}}</h1>
        <p class="text-text-light text-base font-normal leading-relaxed pb-3 pt-1 text-center"
            [innerText]="evento?.descricao"></p>
        <div class="p-4 grid grid-cols-1 gap-y-4">
            @if (evento?.data) {
            <div class="rounded-lg border border-gray-300 bg-white p-4 shadow-sm">
                <div class="flex items-center gap-4">
                    <span class="material-icons gradient-text text-2xl"> calendar_month </span>
                    <div>
                        <p class="text-text-light text-base font-medium leading-normal">Data do Evento</p>
                        <p class="text-text-muted-light text-sm font-normal leading-normal">{{evento?.data}}</p>
                    </div>
                </div>
            </div>
            }
            @if (evento?.hora) {
            <div class="rounded-lg border border-gray-300 bg-white p-4 shadow-sm">
                <div class="flex items-center gap-4">
                    <span class="material-icons gradient-text text-2xl"> schedule </span>
                    <div>
                        <p class="text-text-light text-base font-medium leading-normal">Horário</p>
                        <p class="text-text-muted-light text-sm font-normal leading-normal">{{evento?.hora}}</p>
                    </div>
                </div>
            </div>
            }
            @if (evento?.local) {
            <div class="rounded-lg border border-gray-300 bg-white p-4 shadow-sm">
                <div class="flex items-center gap-4">
                    <span class="material-icons gradient-text text-2xl"> location_on </span>
                    <div>
                        <p class="text-text-light text-base font-medium leading-normal">Local do Encontro</p>
                        <p class="text-text-muted-light text-sm font-normal leading-normal">{{evento?.local}}</p>
                    </div>
                </div>
            </div>
            }
            @if (evento?.valor) {
            <div class="rounded-lg border border-gray-300 bg-white p-4 shadow-sm">
                <div class="flex items-center gap-4">
                    <span class="material-icons gradient-text text-2xl"> monetization_on </span>
                    <div>
                        <p class="text-text-light text-base font-medium leading-normal">Investimento</p>
                        <p class="text-text-muted-light text-sm font-normal leading-normal">{{evento?.valor}}</p>
                    </div>
                </div>
            </div>
            }
        </div>

        @if (verIngressos) {
        <div class="border-t border-gray-200 mt-4 p-4 space-y-2">

            <h3 class="text-2xl font-bold text-text-light">Ingressos Disponíveis</h3>

            <div class="space-y-4 pt-2">
                @for (ingresso of evento.ingressos; track $index) {
                <div class="flex items-center justify-between border border-gray-300 rounded-lg p-4 bg-white shadow-sm">
                    <div>
                        <p class="text-text-light text-base font-medium leading-normal">{{ingresso.tipo}}</p>
                        <p class="text-text-muted-light text-sm font-normal leading-normal">{{ingresso.descricao}}</p>
                        <p class="text-text-light text-base font-medium leading-normal">{{ingresso.precoUnitario |
                            currencyformat}}
                        </p>
                        @if (ingresso.total && (ingresso.total-ingresso.count) < 100 && (ingresso.total-ingresso.count)>
                            0) {
                            <p class="text-text-muted-light text-xs font-normal leading-normal mt-1">Restam somente
                                {{ingresso.total-ingresso.count}} disponíveis!</p>
                            }
                    </div>
                    <div class="text-right">
                        @if (ingresso.total && (ingresso.total-ingresso.count) <= 0) { <p
                            class="text-red-600 text-xs font-normal leading-normal mt-1">Esgotado!</p>
                            } @else {
                            <div class="shrink-0">
                                <div class="flex items-center gap-2 text-[#131712]">
                                    <button
                                        class="text-base font-medium leading-normal flex h-7 w-7 items-center justify-center rounded-full bg-[#f1f4f1] cursor-pointer"
                                        (click)="ingresso.quantidade > 0 && (ingresso.quantidade-=1)">-</button>
                                    <span
                                        class="text-base font-medium leading-normal w-4 p-0 text-center bg-transparent">{{ingresso.quantidade}}</span>
                                    <button
                                        class="text-base font-medium leading-normal flex h-7 w-7 items-center justify-center rounded-full bg-[#f1f4f1] cursor-pointer"
                                        (click)="ingresso.total-ingresso.count > ingresso.quantidade && (ingresso.quantidade+=1)">+</button>
                                </div>
                            </div>
                            }
                    </div>
                </div>
                }
            </div>

            <div class="flex justify-between p-4">
                <p class="text-lg font-bold text-text-light">Total</p>
                <p class="text-lg font-bold text-text-light">{{ totalIngressos | currencyformat }}</p>
            </div>
        </div>

        @if (totalIngressos > 0) {
        <div class="border-t border-gray-200 mt-4">
            @if (userEmail) {
            <div class="p-4">

                <!-- Componente de Detalhes do Perfil -->
                <app-perfil-detalhes (isReady)="isValidPerfil = $event"></app-perfil-detalhes>

                @if (!isValidPerfil) {
                <p class="text-red-600 text-sm mt-2">Por favor, complete seus dados para prosseguir com a compra.</p>
                }

                <hr class="my-6">
            </div>
            } @else {
            <div class="p-4">
                <p class="text-text-muted-light text-sm mb-2">Para prosseguir com a compra, por favor faça login.</p>
                <button
                    class="flex items-center justify-center gap-2 w-full border border-gray-300 text-text-muted-light font-bold py-3 px-4 rounded-lg hover:opacity-90 transition shadow-md"
                    (click)="goPerfil()">
                    <span class="material-icons"> login </span>
                    <span class="text-gray-700 font-medium">Fazer Login</span>
                </button>
            </div>
            }
            @if (isValidPerfil) {
            <div class="p-4">
                <button
                    class="w-full gradient-bg text-white font-bold py-3 px-4 rounded-lg hover:opacity-90 transition shadow-md"
                    (click)="goCheckout()">
                    Ir para o Pagamento
                </button>
            </div>
            }
        </div>
        }
        }@else {
        @if (evento.ingressos?.length > 0) {
        <div class="p-4 pt-8">
            <button
                class="w-full gradient-bg text-white font-bold py-3 px-4 rounded-lg hover:opacity-90 transition shadow-md"
                (click)="verIngressos=true">
                Ver ingressos
            </button>
        </div>
        }
        }
    </div>
</div>
} @else {
<div class="text-center">
    <span>Não encontramos o evento</span>
</div>
}